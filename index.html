<html>
<head>
	<title>MCEdit</title>
	<script src="js/jquery-2.1.1.min.js"></script>
	<script>
		/*versionCompare from http://stackoverflow.com/a/6832721*/
		function compareVersionString(v1, v2, options) {
			var lexicographical = options && options.lexicographical,
			zeroExtend = options && options.zeroExtend,
			v1parts = v1.split('.'),
			v2parts = v2.split('.');

			function isValidPart(x) {
				return (lexicographical ? /^\d+[A-Za-z]*$/ : /^\d+$/).test(x);
			}

			if (!v1parts.every(isValidPart) || !v2parts.every(isValidPart)) {
				return NaN;
			}

			if (zeroExtend) {
				while (v1parts.length < v2parts.length) v1parts.push("0");
				while (v2parts.length < v1parts.length) v2parts.push("0");
			}

			if (!lexicographical) {
				v1parts = v1parts.map(Number);
				v2parts = v2parts.map(Number);
			}

			for (var i = 0; i < v1parts.length; ++i) {
				if (v2parts.length == i) {
					return 1;
				}

				if (v1parts[i] == v2parts[i]) {
					continue;
				}
				else if (v1parts[i] > v2parts[i]) {
					return 1;
				}
				else {
					return -1;
				}
			}

			if (v1parts.length != v2parts.length) {
				return -1;
			}

			return 0;
		}
		function compareVersionObject(a,b) {
			return compareVersionString(a.tag_name, b.tag_name) * -1;
		}
		function createReleaseInfo(data) {
			if (data.length == 0) {
				releaseBannerFail('Couldn\'t find any releases');
				return false;
			}
			try {
				data.sort(compareVersionObject);
				for (var i = 0; i < data.length; i++) {
					var note = data[i].body;
					note = note.replace(/\n/g,'<br>').replace(/@([a-zA-Z0-9]+)/g,' <a href="http://github.com/$1">@$1</a> ');
					var version = data[i].tag_name;
					var title = data[i].name
					if (data[i].prerelease) {
						var releaselabel = 'Pre-release';
					} else {
						var releaselabel = '';
					}
					var releasetime = new Date(data[i].published_at).toLocaleDateString();
					$('#changelog').append('<div class="row releasenote" version="' + version + '"></div>');
					releasenote = $('.releasenote[version="' + version + '"]');
					releasenote.append('<div class="col c2" style="text-align:right;"><div style="padding-right:10px;"><h2 style="display:inline;"><a href="' + data[i].html_url + '">' + version + '</a></h2><br>' + releaselabel + '<br>' + releasetime + '</div></div>');
					releasenote.append('<div class="col c10"><p>' + note + '</p></div></div>');
				}
				$('#changelog').show();
				prereleases = [];
				releases = [];
				for (var i = 0; i < data.length; i++) {
					if (data[i].prerelease) {
						prereleases.push(data[i]);
					} else {
						releases.push(data[i]);
					}
				}
				releases.sort(compareVersionObject);
				prereleases.sort(compareVersionObject);

				if (releases.length > 0) {
					release = releases[0];
					$('#releaseversion').html(release.tag_name);
					for (var i = 0; i < release.assets.length; i++) {
						$('#release-downloads').append('<a href="' + release.assets[i].browser_download_url + '"><i class="fa fa-cloud-download"></i> ' + release.assets[i].name + '</a><br>');
					}
					$('#release-notes').html('<a href="' + release.html_url + '"><i class="fa fa-book"></i> Release notes</a>');
					$('#release-message').slideDown();
				}
				if (prereleases.length > 0) {
					prerelease = prereleases[0];
					$('#prereleaseversion').html(prerelease.tag_name);
					for (var i = 0; i < prerelease.assets.length; i++) {
						$('#prerelease-downloads').append('<a href="' + prerelease.assets[i].browser_download_url + '"><i class="fa fa-cloud-download"></i> ' + prerelease.assets[i].name + '</a><br>');
					}
					$('#prerelease-notes').html('<a href="' + prerelease.html_url + '"><i class="fa fa-book"></i> Release notes</a>');
					$('#prerelease-message').slideDown();
				}
			} catch(err) {
				releaseBannerFail(err.message);
			}
			$('#loading-message').slideUp();
		}
		function releaseBannerFail(message) {
			if (typeof message == "object") {
				message = 'An error occured loading the release information: ' + message.responseJSON.message;
			}
			if (message == undefined) {
				var message = 'An error occured loading the release information';
			}
			$('#failure-reason').html(message);
			$('#failed-message').slideDown();
			$('#loading-message').slideUp();
		}
		$(document).ready(function(){
			$.get('https://api.github.com/repos/Khroki/MCEdit-Unified/releases').done(createReleaseInfo).fail(releaseBannerFail);
		});
	</script>
	<link rel="stylesheet" type="text/css" href="css/min.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/stylesheet.css">
</head>
<body>
	<nav class="nav" tabindex="-1" onclick="this.focus()">
		<div class="container">
			<a class="pagename current" href="#">MCEdit</a>
			<a href="about/index.html">About</a>
			<a href="contributors/index.html">Contributors</a>
			<a href="https://github.com/Khroki/MCEdit-Unified/releases">Releases</a>
		</div>
	</nav>
	<div class="container">
		<div class="msg" id="loading-message">
			<strong><i class="fa fa-refresh"></i> Loading release information</strong>
		</div>
		<div class="msg" id="failed-message" style="display:none;">
			<strong><i class="fa fa-times"></i> <span id="failure-reason"></span></strong>
		</div>
		<div class="msg" style="display:none;" id="prerelease-message">
			<strong>Pre-release version <span id="prereleaseversion">null</span></strong>
			<br>
			<span id="prerelease-notes"></span>
			<br>
			<span id="prerelease-downloads"></span>
		</div>
		<div class="msg" style="display:none;" id="release-message">
			<strong>Release version <span id="releaseversion">null</span></strong>
			<br>
			<span id="release-notes"></span>
			<br>
			<span id="release-downloads"></span>
		</div>

		<div id="changelog" style="display:none;">
		</div>
	</div>
</body>
</html>